<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Text to Sentences with OpenAI</title>
    <!-- React and ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Optional: Include a CSS library or custom styles here -->
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        textarea {
            width: 100%;
            height: 150px;
        }
        input[type="text"] {
            width: 100%;
            padding: 8px;
            margin-top: 10px;
        }
        button {
            padding: 10px 20px;
            margin-top: 10px;
        }
        .sentence {
            background-color: #f0f0f0;
            padding: 8px;
            margin: 5px 0;
            border-radius: 4px;
        }
        .error {
            color: red;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Your TypeScript and JSX Code -->
    <script type="text/babel" data-type="module" data-presets="typescript,react">
        // Ensure Babel uses the necessary presets
        // This configuration might vary based on Babel's setup

        const { useState, useEffect } = React;

        type SentenceSplitterProps = {};

        const SentenceSplitter: React.FC<SentenceSplitterProps> = () => {
            const [text, setText] = useState<string>('');
            const [apiKey, setApiKey] = useState<string>('');
            const [sentences, setSentences] = useState<string[]>([]);
            const [loading, setLoading] = useState<boolean>(false);
            const [error, setError] = useState<string | null>(null);

            // Load API key from URL hash if present
            useEffect(() => {
                const hash = window.location.hash.substring(1);
                if (hash.startsWith('apiKey=')) {
                    const key = decodeURIComponent(hash.split('=')[1]);
                    setApiKey(key);
                }
            }, []);

            const handleSubmit = async (e: React.FormEvent) => {
                e.preventDefault();
                setError(null);

                if (!apiKey) {
                    setError('Please provide your OpenAI API key.');
                    return;
                }

                if (!text.trim()) {
                    setError('Please enter some text to process.');
                    return;
                }

                setLoading(true);

                try {
                    // Prepare the prompt for splitting into sentences
                    const prompt = `Split the following text into an array of individual sentences:\n\n${text}`;

                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({
                            model: 'gpt-4',
                            messages: [
                                { role: 'system', content: 'You are a helpful assistant that splits text into sentences.' },
                                { role: 'user', content: prompt }
                            ],
                            max_tokens: 1000,
                            temperature: 0.3
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error.message || 'API request failed.');
                    }

                    const data = await response.json();
                    const content = data.choices[0].message.content;

                    // Assume the model returns a JSON array of sentences
                    let parsedSentences: string[] = [];

                    try {
                        parsedSentences = JSON.parse(content);
                        if (!Array.isArray(parsedSentences)) {
                            throw new Error('Response is not an array.');
                        }
                    } catch (parseError) {
                        // Fallback: Split by periods if JSON parsing fails
                        parsedSentences = content.split(/(?<=[.?!])\s+/).map(s => s.trim()).filter(s => s.length > 0);
                    }

                    setSentences(parsedSentences);
                } catch (err: any) {
                    setError(err.message || 'An unexpected error occurred.');
                } finally {
                    setLoading(false);
                }
            };

            const handleApiKeyChange = (e: React.ChangeEvent<HTMLInputElement>) => {
                setApiKey(e.target.value);
                // Update the URL hash
                window.location.hash = `apiKey=${encodeURIComponent(e.target.value)}`;
            };

            return (
                <div>
                    <h1>Text to Sentences Converter</h1>
                    <form onSubmit={handleSubmit}>
                        <label>
                            OpenAI API Key:
                            <input
                                type="text"
                                value={apiKey}
                                onChange={handleApiKeyChange}
                                placeholder="Enter your API key"
                                required
                            />
                        </label>
                        <br />
                        <label>
                            Enter Text:
                            <textarea
                                value={text}
                                onChange={(e) => setText(e.target.value)}
                                placeholder="Paste your text here..."
                                required
                            ></textarea>
                        </label>
                        <br />
                        <button type="submit" disabled={loading}>
                            {loading ? 'Processing...' : 'Split into Sentences'}
                        </button>
                    </form>
                    {error && <div className="error">Error: {error}</div>}
                    {sentences.length > 0 && (
                        <div>
                            <h2>Sentences:</h2>
                            {sentences.map((sentence, index) => (
                                <div key={index} className="sentence">
                                    {index + 1}. {sentence}
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<SentenceSplitter />);
    </script>
</body>
</html>
